{"remainingRequest":"D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\babel-loader\\lib\\index.js!D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\porject\\vue02\\testcli3.01\\mall\\src\\views\\detail\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\porject\\vue02\\testcli3.01\\mall\\src\\views\\detail\\Detail.vue","mtime":1616651584829},{"path":"D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\porject\\vue02\\testcli3.01\\mall\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport DetailNavBar from \"./childComps/DetailNavBar\";\nimport DetailSwiper from \"./childComps/DetailSwiper\";\nimport DetailBaseInfo from \"./childComps/DetailBaseInfo\";\nimport DetailShopInfo from \"./childComps/DetailShopInfo\";\nimport DetailGoodsInfo from \"./childComps/DetailGoodsInfo\";\nimport DetailParamsInfo from \"./childComps/DetailParamsInfo\";\nimport DetailCommentInfo from \"./childComps/DetailCommentInfo\";\nimport DetailBottomBar from \"./childComps/DetailBottomBar\";\nimport GoodsList from 'components/centent/goods/GoodsList';\nimport Scroll from 'components/common/scroll/Scroll';\nimport { getDetail, Goods, Shop, GoodsParam, getRecommend } from 'network/detail';\nimport { mixinsData, backTopMixin } from 'common/mixin';\nimport { debounce, debouceY } from 'common/utils';\nexport default {\n  name: 'Detail',\n  mixins: [mixinsData, backTopMixin],\n  components: {\n    DetailNavBar: DetailNavBar,\n    DetailSwiper: DetailSwiper,\n    DetailBaseInfo: DetailBaseInfo,\n    DetailShopInfo: DetailShopInfo,\n    DetailGoodsInfo: DetailGoodsInfo,\n    DetailParamsInfo: DetailParamsInfo,\n    DetailCommentInfo: DetailCommentInfo,\n    DetailBottomBar: DetailBottomBar,\n    GoodsList: GoodsList,\n    Scroll: Scroll\n  },\n  data: function data() {\n    return {\n      iid: null,\n      topImages: [],\n      goods: {},\n      shop: {},\n      detailInfo: {},\n      itemParams: {},\n      commentInfo: {},\n      recommends: [],\n      themeTopY: [],\n      getThemeTopYData: null,\n      titleIndex: 0\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    this.iid = this.$route.params.iid; // 根据 id 请求数据\n\n    getDetail(this.iid).then(function (res) {\n      var data = res.result;\n      _this.topImages = data.itemInfo.topImages; // 获取描述的信息\n\n      _this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services); // 获取店铺的信息\n\n      _this.shop = new Shop(data.shopInfo); // 获取详情数据\n\n      _this.detailInfo = data.detailInfo; // 商品参数信息\n\n      _this.itemParams = new GoodsParam(data.itemParams.info, data.itemParams.rule); // 评论信息\n\n      if (data.rate.cRate !== 0) {\n        _this.commentInfo = data.rate.list[0];\n      } // 下一帧\n      // this.$nextTick(() => {\n      //   // 2.\n      //   // DOM渲染完成 但是图片还没加载完成\n      //   // this.themeTopY = []\n      //   // this.themeTopY.push(0)\n      //   // this.themeTopY.push(this.$refs.params.$el.offsetTop)\n      //   // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\n      //   // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\n      // })\n\n    }); // 获取详情页推荐数据\n\n    getRecommend().then(function (res) {\n      _this.recommends = res.data.list;\n    }); // 给getThemeTopYData  防抖\n\n    this.getThemeTopYData = debouceY(function () {\n      _this.themeTopY = [];\n\n      _this.themeTopY.push(0);\n\n      _this.themeTopY.push(_this.$refs.params.$el.offsetTop);\n\n      _this.themeTopY.push(_this.$refs.comment.$el.offsetTop);\n\n      _this.themeTopY.push(_this.$refs.recommends.$el.offsetTop);\n\n      _this.themeTopY.push(Number.MAX_VALUE);\n    }, 100);\n  },\n  methods: {\n    imgLoadMore: function imgLoadMore() {\n      this.newRefresh();\n      this.getThemeTopYData(); // this.getThemeTopYData();\n      // 3.\n      // this.themeTopY = []\n      // this.themeTopY.push(0)\n      // this.themeTopY.push(this.$refs.params.$el.offsetTop)\n      // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\n      // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\n    },\n    titleClick: function titleClick(index) {\n      this.$refs.scroll.scrollTo(0, -this.themeTopY[index], 1000 / 60);\n    },\n    contentScroll: function contentScroll(position) {\n      // 获取 页面滚动的 距离 显示对应的 title\n      var positionY = -position.y;\n      var length = this.themeTopY.length;\n\n      for (var i = 0; i < length; i++) {\n        if (this.titleIndex !== i) {\n          if (positionY >= this.themeTopY[i] && positionY < this.themeTopY[i + 1]) {\n            this.titleIndex = i;\n            this.$refs.detailNavBar.actviveIndex = this.titleIndex;\n          }\n        }\n      }\n\n      this.isShowBack(position);\n    },\n    addCart: function addCart() {\n      // 获取购物车需要展示的数据\n      var product = {};\n      product.image = this.topImages[0];\n      proudct.title = this.goods.title;\n      proudct.desc = this.goods.desc;\n      proudct.price = this.goods.realPrice;\n      proudct.iid = this.iid; // 将点击的商品添加到购物车\n\n      this.$store.commit('addCart', product);\n    }\n  },\n  updated: function updated() {// 1.\n    // this.themeTopY = []\n    // this.themeTopY.push(0)\n    // this.themeTopY.push(this.$refs.params.$el.offsetTop)\n    // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\n    // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\n  },\n  destroyed: function destroyed() {}\n};",{"version":3,"sources":["Detail.vue"],"names":[],"mappings":"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","sourcesContent":["<template lang=\"\">\r\n  <div class=\"detail\">\r\n    <detail-nav-bar @titleClick=\"titleClick\" ref=\"detailNavBar\" />\r\n    <scroll class=\"content\" ref=\"scroll\" \r\n            :probe-type=\"3\"\r\n            @scroll=\"contentScroll\">\r\n      <detail-swiper :top-images=\"topImages\" />\r\n      <detail-base-info :goods=\"goods\" />\r\n      <detail-shop-info :shop=\"shop\" />\r\n      <detail-goods-info :detail-info=\"detailInfo\" @imagesInfo=\"imgLoadMore\" />\r\n      <detail-params-info ref=\"params\" :detail-params=\"itemParams\" />\r\n      <detail-comment-info ref=\"comment\" :comment-info=\"commentInfo\" />\r\n      <goods-list ref=\"recommends\" :goods=\"recommends\" />\r\n    </scroll>\r\n    <detail-bottom-bar class=\"detailBottomBar\" ref=\"detailBottomBar\" @addCart=\"addCart\" />\r\n    <!-- 组件点击事件需要添加事件修饰符 -->\r\n    <back-top @click.native=\"backClick\" v-show=\"isShowBackTop\" />\r\n  </div>\r\n</template>\r\n<script>\r\nimport DetailNavBar from './childComps/DetailNavBar'\r\nimport DetailSwiper from './childComps/DetailSwiper'\r\nimport DetailBaseInfo from './childComps/DetailBaseInfo'\r\nimport DetailShopInfo from './childComps/DetailShopInfo'\r\nimport DetailGoodsInfo from './childComps/DetailGoodsInfo'\r\nimport DetailParamsInfo from './childComps/DetailParamsInfo'\r\nimport DetailCommentInfo from './childComps/DetailCommentInfo'\r\nimport DetailBottomBar from './childComps/DetailBottomBar'\r\nimport GoodsList from 'components/centent/goods/GoodsList'\r\n\r\nimport Scroll from 'components/common/scroll/Scroll'\r\n\r\nimport {getDetail, Goods, Shop, GoodsParam, getRecommend} from 'network/detail'\r\n\r\nimport {mixinsData, backTopMixin} from 'common/mixin'\r\nimport {debounce, debouceY} from 'common/utils'\r\nexport default {\r\n  name: 'Detail',\r\n  mixins: [mixinsData, backTopMixin],\r\n  components: {\r\n    DetailNavBar,\r\n    DetailSwiper,\r\n    DetailBaseInfo,\r\n    DetailShopInfo,\r\n    DetailGoodsInfo,\r\n    DetailParamsInfo,\r\n    DetailCommentInfo,\r\n    DetailBottomBar,\r\n    GoodsList,\r\n    Scroll\r\n  },\r\n  data() {\r\n    return {\r\n      iid: null,\r\n      topImages: [],\r\n      goods: {},\r\n      shop: {},\r\n      detailInfo: {},\r\n      itemParams: {},\r\n      commentInfo: {},\r\n      recommends: [],\r\n      themeTopY: [],\r\n      getThemeTopYData: null,\r\n      titleIndex: 0\r\n    }\r\n  },\r\n  created() {\r\n    this.iid = this.$route.params.iid\r\n    // 根据 id 请求数据\r\n    getDetail(this.iid).then(res => {\r\n      let data = res.result;\r\n      this.topImages = data.itemInfo.topImages;\r\n      // 获取描述的信息\r\n      this.goods = new Goods(data.itemInfo, data.columns, data.shopInfo.services);\r\n      // 获取店铺的信息\r\n      this.shop = new Shop(data.shopInfo);\r\n      // 获取详情数据\r\n      this.detailInfo = data.detailInfo;\r\n      // 商品参数信息\r\n      this.itemParams = new GoodsParam(data.itemParams.info, data.itemParams.rule);\r\n      // 评论信息\r\n      if(data.rate.cRate !== 0) {\r\n        this.commentInfo = data.rate.list[0];\r\n      }\r\n      // 下一帧\r\n      // this.$nextTick(() => {\r\n      //   // 2.\r\n      //   // DOM渲染完成 但是图片还没加载完成\r\n      //   // this.themeTopY = []\r\n      //   // this.themeTopY.push(0)\r\n      //   // this.themeTopY.push(this.$refs.params.$el.offsetTop)\r\n      //   // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\r\n      //   // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\r\n      // })\r\n    });\r\n    // 获取详情页推荐数据\r\n    getRecommend().then(res => {\r\n      this.recommends = res.data.list;\r\n    })\r\n    // 给getThemeTopYData  防抖\r\n    this.getThemeTopYData = debouceY( () => {\r\n      this.themeTopY = []\r\n      this.themeTopY.push(0)\r\n      this.themeTopY.push(this.$refs.params.$el.offsetTop)\r\n      this.themeTopY.push(this.$refs.comment.$el.offsetTop)\r\n      this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\r\n      this.themeTopY.push(Number.MAX_VALUE)\r\n    }, 100)\r\n  },\r\n  methods: {\r\n    imgLoadMore() {\r\n      this.newRefresh();\r\n      this.getThemeTopYData()\r\n      // this.getThemeTopYData();\r\n      // 3.\r\n      // this.themeTopY = []\r\n      // this.themeTopY.push(0)\r\n      // this.themeTopY.push(this.$refs.params.$el.offsetTop)\r\n      // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\r\n      // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\r\n    },\r\n    titleClick(index){\r\n      this.$refs.scroll.scrollTo(0, -this.themeTopY[index] ,1000/60)\r\n    },\r\n    contentScroll(position) {\r\n      // 获取 页面滚动的 距离 显示对应的 title\r\n      const positionY = -position.y;\r\n      let length = this.themeTopY.length;\r\n      for (let i = 0; i < length; i++) {\r\n        if(this.titleIndex !== i) {\r\n          if(positionY >= this.themeTopY[i] && positionY < this.themeTopY[i+1]) {\r\n            this.titleIndex = i;\r\n            this.$refs.detailNavBar.actviveIndex = this.titleIndex;\r\n          }\r\n        }\r\n      }\r\n      this.isShowBack(position);\r\n    },\r\n    addCart() {\r\n      // 获取购物车需要展示的数据\r\n      const product = {};\r\n      product.image = this.topImages[0];\r\n      proudct.title = this.goods.title;\r\n      proudct.desc = this.goods.desc;\r\n      proudct.price = this.goods.realPrice;\r\n      proudct.iid = this.iid\r\n\r\n      // 将点击的商品添加到购物车\r\n      this.$store.commit('addCart', product)\r\n    }\r\n  },\r\n  updated() {\r\n    // 1.\r\n    // this.themeTopY = []\r\n    // this.themeTopY.push(0)\r\n    // this.themeTopY.push(this.$refs.params.$el.offsetTop)\r\n    // this.themeTopY.push(this.$refs.comment.$el.offsetTop)\r\n    // this.themeTopY.push(this.$refs.recommends.$el.offsetTop)\r\n  },\r\n  destroyed() {\r\n    \r\n  },\r\n}\r\n</script>\r\n<style scoped>\r\n  .detail {\r\n    position: relative;\r\n    background-color: #fff;\r\n    z-index: 9;\r\n    height: 100vh;\r\n    overflow: hidden;\r\n  }\r\n  .content {\r\n    height: calc(100% - 44px - 49px);\r\n  }\r\n</style>"],"sourceRoot":"src/views/detail"}]}